A seguir est√° a vers√£o refeita e completa da especifica√ß√£o, j√° incluindo:

* **Login** para a psic√≥loga (e futuro multiusu√°rio).
* No **cadastro da empresa**, uma configura√ß√£o: **‚Äúperguntar se o candidato j√° trabalhou aqui?‚Äù**.
* Algumas empresas **N√ÉO podem aparecer** para o candidato (sigilo), ent√£o a pergunta deve poder ser:

  * **com o nome da empresa** (ex.: ‚ÄúVoc√™ j√° trabalhou na Othil?‚Äù) **OU**
  * **gen√©rica** (ex.: ‚ÄúVoc√™ j√° trabalhou nesta empresa anteriormente?‚Äù) sem revelar o nome.

---

# Projeto: Sistema de Capta√ß√£o e Triagem de Candidatos via WhatsApp (Multiempresa, Sigiloso, com Link e Hist√≥rico)

## 1) Objetivo

Sistema para recrutamento onde o primeiro contato ocorre pelo WhatsApp sem dados estruturados. O gestor cria um pr√©-cadastro apenas com o telefone, vincula internamente a uma empresa e setor/vaga, gera protocolo e link de cadastro, e o sistema abre automaticamente uma conversa no WhatsApp com mensagem pronta para envio.

O sistema deve manter um hist√≥rico datado de todos os eventos (cadastro criado, link gerado, link enviado, cadastro preenchido, contatos e reenvios) e permitir exporta√ß√£o para Excel/CSV.

**Regra cr√≠tica:** o candidato n√£o pode saber qual empresa/cliente est√° por tr√°s do processo quando a empresa estiver marcada como sigilosa.

---

## 2) Usu√°rios e permiss√µes

### 2.1 Psic√≥loga/Gestora (Admin)

* Acessa o sistema via login
* Cadastra empresas e setores/vagas
* Cria pr√©-cadastro por telefone
* Define empresa e setor/vaga internamente
* Gera protocolo e link do candidato
* Dispara/abre WhatsApp com mensagem padr√£o (wa.me)
* Marca como ‚Äúenviado‚Äù e registra contatos
* Visualiza e edita dados do candidato
* Exporta dados para Excel/CSV

### 2.2 Candidato (externo)

* Acessa link e preenche dados
* N√£o v√™ empresa/cliente (especialmente se a empresa for sigilosa)
* V√™ apenas textos neutros e campos necess√°rios

---

## 3) Login (p√°gina obrigat√≥ria)

### 3.1 Tela de Login

* E-mail/usu√°rio
* Senha
* ‚ÄúEntrar‚Äù
* (Opcional) ‚ÄúEsqueci minha senha‚Äù (pode ficar para fase 2)

### 3.2 Regras

* Todas as p√°ginas internas exigem autentica√ß√£o
* Registrar em log qual usu√°rio realizou altera√ß√µes e contatos (auditoria)

---

## 4) Cadastro de Empresa (com regras de sigilo e pergunta ‚Äúj√° trabalhou aqui?‚Äù)

### 4.1 Campos da Empresa (interno)

* **nome_interno** (obrigat√≥rio) ‚Äî exemplo: ‚ÄúOthil‚Äù, ‚ÄúCliente A‚Äù
* status (ativo/inativo)
* observa√ß√µes internas

### 4.2 Configura√ß√µes importantes da Empresa (novas)

1. **empresa_sigilosa** (boolean)

* Se **true**: o nome n√£o pode aparecer em nenhuma tela do candidato e nem em mensagens autom√°ticas.
* Se **false**: pode aparecer, se voc√™s quiserem (mas n√£o √© obrigat√≥rio).

2. **perguntar_recontratacao** (boolean)

* Se **true**: o formul√°rio do candidato deve incluir a pergunta ‚Äúj√° trabalhou aqui?‚Äù

3. **modo_pergunta_recontratacao** (enum)

* `COM_NOME` (apenas se empresa_sigilosa = false)

  * Exemplo: ‚ÄúVoc√™ j√° trabalhou na Othil?‚Äù
* `GENERICO` (compat√≠vel com empresa_sigilosa = true ou false)

  * Exemplo: ‚ÄúVoc√™ j√° trabalhou nesta empresa anteriormente?‚Äù

**Regra de valida√ß√£o:**

* Se `empresa_sigilosa = true`, o sistema deve **for√ßar** `modo_pergunta_recontratacao = GENERICO`.

---

## 5) Cadastro de Setores/Vagas (por empresa)

Campos:

* empresa_id
* nome do setor/vaga (ex.: Expedi√ß√£o, Call Center, Reposi√ß√£o)
* status (ativo/inativo)
* observa√ß√µes internas

---

## 6) Dados do candidato (o que ele preenche)

Campos obrigat√≥rios no formul√°rio:

* **Nome**
* **CPF**
* **Telefone** (travado ou validado para ser o mesmo do pr√©-cadastro)
* **Valor de VT (ida e volta)** em R$
* **Escolaridade**
* **Data de nascimento**
* **Prefer√™ncia de hor√°rio** (multi-sele√ß√£o):

  * Manh√£
  * Tarde
  * Noite
    (permitir 1, 2 ou 3)

Campo condicional (por empresa):

* **J√° trabalhou nesta empresa?** (SIM/N√ÉO)

  * Aparece apenas se `perguntar_recontratacao = true`
  * Texto depende do modo (com nome ou gen√©rico)

---

## 7) Fluxo principal do sistema (com abertura autom√°tica do WhatsApp)

### Passo A ‚Äî Pr√©-cadastro por telefone

1. Psic√≥loga entra no sistema (login).
2. Cria pr√©-cadastro informando:

* telefone (obrigat√≥rio)
* seleciona empresa (obrigat√≥rio)
* seleciona setor/vaga (obrigat√≥rio)

**Regra:** telefone deve ser √∫nico (normalizado). Se j√° existir, o sistema n√£o cria duplicado; abre o cadastro existente.

### Passo B ‚Äî Gerar protocolo e link do candidato

3. Ao salvar o pr√©-cadastro, o sistema gera:

* **protocolo √∫nico** (ex.: `NIO-20250512-0041`)
* **link com token seguro**:

  * `https://dominio.com/cadastro/t/<token>`

O token deve mapear internamente:

* candidate_id (ou process_id)
* empresa_id
* setor_id
* created_at
* status do link (gerado/enviado/usado)
* expira√ß√£o opcional

### Passo C ‚Äî Abrir conversa no WhatsApp com mensagem pronta

4. O sistema deve mostrar um bot√£o: **‚ÄúEnviar no WhatsApp‚Äù**

* Ao clicar, abre:

  * `https://wa.me/<telefone>?text=<mensagem_url_encoded>`

Conte√∫do da mensagem (neutro, sem empresa):

> Ol√°! üòä Tudo bem?
> Para eu concluir seu cadastro no processo seletivo, preencha este formul√°rio rapidinho:
> **Protocolo:** NIO-20250512-0041
> Link: [https://dominio.com/cadastro/t/8F3KQ2](https://dominio.com/cadastro/t/8F3KQ2)
> Obrigado!

5. Ao clicar em ‚ÄúEnviar no WhatsApp‚Äù, registrar evento:

* **WHATSAPP_ABERTO_PARA_ENVIO** (data/hora)

6. Deve existir um bot√£o **‚ÄúMarcar como enviado‚Äù** (MVP)

* Ao clicar, registrar:
* **LINK_ENVIADO_CONFIRMADO** (data/hora)

> Fase 2: integra√ß√£o com WhatsApp Business API para registrar envio automaticamente.

### Passo D ‚Äî Candidato preenche e sistema registra

7. Quando o candidato envia o formul√°rio:

* valida CPF
* valida telefone (igual ao pr√©-cadastro, ou checagem forte)
* aplica campos condicionais da empresa (recontrata√ß√£o)

8. Atualizar status e registrar:

* **CADASTRO_PREENCHIDO** (data/hora)

---

## 8) Hist√≥rico datado (linha do tempo obrigat√≥ria)

O sistema deve manter uma linha do tempo com eventos e datas, por exemplo:

* 12/05 ‚Äî Pr√©-cadastro criado
* 12/05 ‚Äî Empresa e setor definidos
* 12/05 ‚Äî Protocolo e link gerados
* 14/05 ‚Äî WhatsApp aberto para envio
* 14/05 ‚Äî Link enviado confirmado
* 14/05 ‚Äî Cadastro preenchido
* 15/05 ‚Äî Tentativa de contato / contato realizado / entrevista marcada

### Estrutura de Evento (log)

* id
* candidate_id (ou process_id)
* datetime
* tipo_evento
* descri√ß√£o/observa√ß√£o
* user_id (psic√≥loga)

---

## 9) Regras de duplicidade (bloqueios)

* Telefone normalizado deve ser √∫nico no cadastro base
* CPF, quando informado, n√£o pode duplicar:

  * se existir, bloquear ou sinalizar ‚Äúduplicidade prov√°vel‚Äù para o admin
* Ao tentar cadastrar novamente:

  * o sistema deve direcionar para o registro existente

---

## 10) Telas (MVP)

### Internas (com login)

1. Login
2. Dashboard (filas)

* aguardando envio
* aguardando preenchimento
* cadastro completo
* pend√™ncias

3. Empresas (CRUD + configura√ß√µes sigilo/recontrata√ß√£o)
4. Setores/Vagas (CRUD)
5. Candidatos (lista + busca por telefone/CPF/nome/protocolo)
6. Detalhe do candidato/processo

* dados
* empresa/vaga (interno)
* protocolo/link
* bot√µes: enviar WhatsApp, marcar enviado, reenviar link
* linha do tempo
* registrar contato (evento manual)

7. Exporta√ß√£o

* filtros por empresa/vaga/status/per√≠odo
* exportar XLSX/CSV

### Externa (candidato)

1. P√°gina de cadastro via token (sem empresa)

* formul√°rio
* pergunta condicional ‚Äúj√° trabalhou aqui?‚Äù conforme configura√ß√£o
* confirma√ß√£o final neutra

---

## 11) Exporta√ß√£o (Excel/CSV)

Requisitos:

* Exportar candidatos e/ou inscri√ß√µes por filtros
* Incluir:

  * dados do candidato
  * empresa/vaga (interno)
  * status
  * datas principais (criado, link gerado, enviado, preenchido)
  * hist√≥rico (opcional: export separado ou aba ‚ÄúEventos‚Äù)

---

## 12) Observa√ß√µes t√©cnicas (para implementa√ß√£o)

* Banco: PostgreSQL (ideal) / SQLite (MVP)
* Backend: API com autentica√ß√£o (sessions/JWT)
* Frontend: painel web + p√°gina p√∫blica do candidato
* Gera√ß√£o de token seguro para links
* Normaliza√ß√£o de telefone e valida√ß√£o de CPF
* Logs/auditoria por usu√°rio (login)

---

Se voc√™ quiser ‚Äúamarrar‚Äù isso ainda mais para a IA programar, eu consigo te entregar tamb√©m:

* as tabelas j√° em SQL (CREATE TABLE),
* os endpoints (rotas) da API,
* e o layout m√≠nimo das p√°ginas (wireframe) ‚Äî tudo consistente com esses requisitos.
